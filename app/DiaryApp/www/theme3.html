<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <!-- <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" /> -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />  
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src *" />
    <link rel="stylesheet" type="text/css" href="css/customx.css" />
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"> -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>
        ul {list-style: none;padding: 0px;margin: 0px;}
        ul li {display: block; border: none;}
        li ul {display: none;}
      ul li a {display: block; text-decoration: none;
               white-space: nowrap;color:   #696969;}
      ul li a:hover {background-image: url(../images/settings_two1.png); background-repeat: no-repeat;}
     
      li:hover ul {display: block; position: absolute;}
     /* li:hover li {float: none;}*/
      li:hover ul li a {padding: 5px;  background:#ccccff; font-size: 18px; font-size: 4vw; font-family: "Century Gothic";} 
      /*li:hover li a:hover {background: white;}*/
      #drop-nav li ul li {border-top: 0px;}
</style>
    </style>   
    <title>Memoir</title>
</head>

<body>

   

    <div id="main">
        <header>
            <nav>
                <a href="#" class="logo"><img src="../images/newlogo2.png"></a>
                <!-- <a href="#" class="notification"><img src="../images/notif.png"></a> -->
                <ul id="drop-nav">
                    <li><a href="#" class="settings"></a>
                        <ul>
                           <li><a href="theme_setting.html" style="margin-left: 190%; margin-top: 60px; width: 100%;">Themes</a></li>
                            <li><a href="#" style="margin-left: 190%; width: 100%;">Sort Ascending</a></li>
                            <li><a href="#" style="margin-left: 190%; width: 100%;">Sort Descending</a></li>
                            <li class="divider"></li> 
                            <li><a onclick="logout()" style="margin-left: 190%; width: 100%;">Logout</a></li>
                            <script>
                                  function logout(){
                                      localStorage.clear();
                                      location = "index.html";
                                    }
                            </script>
                        </ul>
                    </li>
                </ul>
                    
                
            </nav>
        </header>
        <div id="storiescontainer" style="padding-top: 80px; position: relative; padding-bottom: 80px;"></div>
        <div onclick="openSearch()" class="searchbar" style="position: fixed; bottom: 20%; right: 0%; z-index: 20;"></div>
        <div onclick="go_to_add()" class="add" style="position: fixed; bottom: 5%; right: 0%; z-index: 20;"></div>
        <script>
                    function go_to_add(){
                        try{
                            localStorage.setItem('edit','false');
                        }catch{
                            console.log("error");
                        }finally{
                            location = "add_story3.html";
                        }
                    }
        </script>
    </div>


<<!-- div id="footer">
            <div class="container">
                
                <div class="search">
                </div>
                <script>
                    function go_to_add(){
                        try{
                            localStorage.setItem('edit','false');
                        }catch{
                            console.log("error");
                        }finally{
                            location = "add_story3.html";
                        }
                    }
                </script>

                <div class="home">
                </div>
                <div class="planner">
                </div>
                <div class="share">
                </div> -->
                <!-- <div onclick="myFunction()" class="settings"></div>
                        <div id="myDropdown" class="dropdown-content">
                            <a href="#home">Home</a>
                            <a href="#about">About</a>
                            <a href="#contact">Contact</a>
                        </div> -->
    <script>
            function myFunction() {
            document.getElementById("myDropdown").classList.toggle("show");
            }
            window.onclick = function(event) {
        if (!event.target.matches('.settings')) {

            var dropdowns = document.getElementsByClassName("dropdown-content");
            var i;
        for (i = 0; i < dropdowns.length; i++) {
            var openDropdown = dropdowns[i];
        if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
                    }
                }
            }
        }
    </script>
    </div>
</div>

    <script src="js/jquery-3.3.1.min.js"></script>    
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript">
        app.initialize();
    </script>
    <script>
        

        var acc_id = localStorage.getItem('acc_id');
        var token = localStorage.getItem('token');
        console.log(acc_id);
        console.log(token);
        

        $('#myModal').on('shown.bs.modal', function () {
        $('#myInput').trigger('focus')
        })

        // var url  = 'https://vast-woodland-99478.herokuapp.com/myStory';
        // var xhr  = new XMLHttpRequest()
        // xhr.open('POST', url, true)
        // xhr.onload = function () {
            
        //     if (xhr.readyState == 4 && xhr.status == "200") {
        //         var json = JSON.parse(xhr.responseText);
        //         var story='';
        //         $.each(json,function(key,value){
        //             story += '<div id="storycontainer"><h1>'+json.title+'</h1><div id="datetimecontainer"><ul><h2>Date Created:</h2><h2 style="color:    #808080; font-style: italic; ">September 16, 2018</h2> <h2>Time Created:</h2> <h2 style="color:    #808080; font-style: italic;">10:32 pm</h2></ul></div><div id="optioncontainer">    <div id="editbutton"></div><div id="deletebutton"></div><div id="sharebutton"></div></div></div>';
                      
        //         });
        //         $('#storiescontainer').append(story);
        //     } else {
        //         alert("error")
        //     }
        // }
        // var json =JSON.stringify({ "token": token, "acc_id": acc_id  });
        // xhr.send(json);
        function pick_story(story_id){
            $.ajax({
                url: 'https://vast-woodland-99478.herokuapp.com/viewStory',
                dataType: 'json',
                type: 'post',
                contentType: 'application/json',
                data: JSON.stringify({"acc_id": acc_id, "token": token, "story_id": story_id}),
                processData: false,
                success: function( data, textStatus, jQxhr ){
                    localStorage.setItem('title', data.title);
                    localStorage.setItem('text', data.text);

                    var dateString = data.created_date;
                    var datcut = new Date(dateString).toUTCString();
                    var date_split = datcut.split(' ').slice(0, 4).join(' ');

                    localStorage.setItem('date', date_split);
                    localStorage.setItem('story_id', story_id);
                    location = 'view_story3.html';
                },
                error: function( jqXhr, textStatus, errorThrown ){
                    console.log( errorThrown );
                    
                }
            });

        }



        $(document).ready(function(){
            $.getJSON("https://vast-woodland-99478.herokuapp.com/myStory/"+acc_id+"/"+token,function(data){
                var story='';

                $.each(data,function(key,value){
                    var dateString = value.created_date;
                    var datcut = new Date(dateString).toUTCString();
                    var date_split = datcut.split(' ').slice(0, 4).join(' ');
                    var time_split = datcut.split(' ').slice(4).join(' ');
                    story += '<div onclick = "pick_story('+value.rec_id+')" class="storycontainer"><center><h3>'+value.title+'</h3></center><div id="datetimecontainer"><ul style="padding-left: 0px;"><h2>Date Created:</h2><h2 style="color: #050505; font-style: italic; font-size: 10px;">'+date_split+'</h2><br> <h2>Time Created:</h2> <h2 style="color:#050505; font-style: italic; font-size: 10px;">'+time_split+'</h2></ul></div></div>';
                      
                });
                $('#storiescontainer').append(story);
            });
        });

        //  $.ajax({
        //     url: 'https://vast-woodland-99478.herokuapp.com/myStory',
        //     dataType: 'json',
        //     type: 'post',
        //     contentType: 'application/json',
        //     data: JSON.stringify({"acc_id": acc_id,"token": token}),
        //     processData: false,
        //     success: function( data, textStatus, jQxhr ){

        //         alert(data.data)
        //     // $.each(data,function(key,value){
        //     //     alert(textStatus)
        //     //         story += '<div id="storycontainer"><h1>'+value.title+'</h1><div id="datetimecontainer"><ul><h2>Date Created:</h2><h2 style="color:    #808080; font-style: italic; ">September 16, 2018</h2> <h2>Time Created:</h2> <h2 style="color:    #808080; font-style: italic;">10:32 pm</h2></ul></div><div id="optioncontainer">    <div id="editbutton"></div><div id="deletebutton"></div><div id="sharebutton"></div></div></div>';
                      
        //     //     });
        //     //     $('#storiescontainer').append(story);
                
                

        //     },
        //     error: function( jqXhr, textStatus, errorThrown ){
        //         console.log( errorThrown );
        //         alert("error")
        //     }
        // });

function openSearch() {
  document.getElementById("myOverlay").style.display = "block";
}

function closeSearch() {
  document.getElementById("myOverlay").style.display = "none";
}
        
    </script>

      <!-- Modal -->
 
 <div id="myOverlay" class="overlay">
  <span class="closebtn" onclick="closeSearch()" title="Close Overlay">×</span>
  <div class="overlay-content">
    <form action="/action_page.php">
      <input type="text" placeholder="Search.." name="search">
      <button type="submit" style="background-image: url(images/search.png);"></button>
    </form>
  </div>
</div>
    
</body>

</html>